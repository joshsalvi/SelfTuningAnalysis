function [DataVar] = LeveledXdFits2(timeseries,window,PulseStart,PulseEnd,automateyn)LevelXd = zeros(1,length(timeseries)-20);TimeLen = length(timeseries);endvals = [PulseStart+150,PulseEnd,PulseEnd+100];startvals = [PulseStart+10,endvals(1),PulseEnd+13];diff = [startvals(1)-PulseStart,startvals(1)-PulseStart,(startvals(1)-PulseStart)+(startvals(3)-PulseEnd)];LevelXd(1:PulseStart)=timeseries(1:PulseStart)'-mean(timeseries(1:PulseStart));j=0;figureplot(timeseries);if automateyn==0for k = 1:3    while j<1                [fitparams,gof]=fit([0:endvals(k)-startvals(k)]',timeseries(startvals(k):endvals(k))-timeseries(startvals(k)),'exp2')        coeffs=coeffvalues(fitparams);        confints=confint(fitparams);          hold on        plot([startvals(k)-20:endvals(k)],fitparams(0-20:endvals(k)-startvals(k))+timeseries(startvals(k)),'r');            if input('Good fit? (1=yes) ')==1            j=1;            LevelXd(startvals(k)-diff(k):endvals(k)-diff(k))=timeseries(startvals(k):endvals(k))-(fitparams(0:endvals(k)-startvals(k))+timeseries(startvals(k)));        else            startvals(k)=input('Start value?');            endvals(k)=input('End value?');            diff = [startvals(1)+1-PulseStart,startvals(1)+1-PulseStart,(startvals(1)-PulseStart)+(startvals(3)-PulseEnd)];            if k == 1                startvals(2)=endvals(1);            end        end        end    j=0;endelse    for k = 1:3    while j<1                [fitparams,gof]=fit([0:endvals(k)-startvals(k)]',timeseries(startvals(k):endvals(k))-timeseries(startvals(k)),'exp2')        coeffs=coeffvalues(fitparams);        confints=confint(fitparams);          hold on        plot([startvals(k)-20:endvals(k)],fitparams(0-20:endvals(k)-startvals(k))+timeseries(startvals(k)),'r');                j=1;            LevelXd(startvals(k)-diff(k):endvals(k)-diff(k))=timeseries(startvals(k):endvals(k))-(fitparams(0:endvals(k)-startvals(k))+timeseries(startvals(k)));    end    j=0;endLevelXd(endvals(3)+1-diff(3):TimeLen-diff(3))=timeseries(endvals(3)+1:TimeLen)'-mean(timeseries(endvals(3)+1:TimeLen));figureplot(LevelXd)[DataVar] = XdVar(LevelXd,window);end